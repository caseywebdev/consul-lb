#!/bin/sh

set -e

COMMAND='/code/bin/reload'
if [ "$USE_SSL" == "1" ]; then
  COMMAND='/code/bin/check-and-reload'
fi

echo 'Watching for service changes'
exec consul-template \
  -consul-addr $CONSUL_URL \
  -dedup \
  -template /code/etc/nginx.conf:/etc/nginx/nginx.conf:$COMMAND
